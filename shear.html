<!doctype html public "-//w3c//dtd html 4.0 transitional//en">

<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<head>
<title>せん断変形を行う</title>
</head>

<body bgcolor="ffffcc">
<center><h2 style="color:Blue;">せん断変形を行う</h2></center><br>

この講座からは少しずつ材料力学的な内容になっていくが、それほど専門的な内容ではないので大学の教養物理学程度の知識があれば問題ないであろう。<br><br>

		ある材料に関してその強度の情報が必要な場合、実験装置を用いて試料を強制的に変形しその応答を調べる方法がとられることが多い。そのような変形をMDによって実現すればこれまで実験的に行ってきた研究をMDで代替できるようになる。この講座では、そのような解析に用いる変形の一つであるせん断変形をMDで行う方法を学ぶ。<br><br>

せん断変形とは材料のある2つの平行な面で、例えば上下の面で、異なった横方向の力を加える種類の変形である。例えば、下の図のように材料の下部を固定し、上部を強制的に横方向に移動させる変形がせん断変形に属する。以下で、鉄の結晶をせん断変形するMDを紹介していく。<br><br>

		<br><br>
		<center><img src="shear.jpg" width="500"></center>
		<br><br>

このMDを行うための大まかな手続きの流れを述べると、まず鉄の結晶を絶対0度で構造緩和させ、そしてある有限温度にてアニールする。このコースを最初から順番に学んできた人は、これらを行う方法はすでに学んだはずだ。その後、上図のように試料の下部を固定し、図の黒い矢印で示されたように上部を一定の速度で移動させることによってせん断変形を実現することができる。このMDを実行するためのスクリプトがscriptディレクトリの中の"bccFe_shear.lcm"である。以下のコマンドラインを標準入力に入れることによりこのMDが実行される。

<pre>
<font color="green"; size="+1">
$work> lmp_serial -v x_lattice 25 -v y_lattice 25 -v z_lattice 25 -v max_step 5000 -in script/bccFe_shear.lcm
</font>
</pre>

上のコマンドラインの"-v"はすでに紹介した"-in"と同じようにフラグの一種である。この"-v"フラグを使うことによって実行前にLAMMPSで使われる変数を定義することができる。<b>この方法は１つのスクリプトで異なったケースを計算できる便利な方法なのでぜひ覚えておいて欲しい。</b>以下で改めて説明するが、このケースではボックスのサイズが25a（aは格子定数）、およびせん断変形の持続時間長さ(2000 fs)が定義されている。<br><br>
	LAMMPSでの計算が成功すると、workディレクトリに"bccFe_shear_???.out"という形式のファイルが多数できる。ただし、???の部分は時刻に関する情報（すなわち計算ステップ数）が入る。これのどれかをOVITOで読み込めば、この形式のファイルは全て読み込まれる。前回と同様に動画を実行すればせん断変形の様子を観察することができる。下にxz面で見た動画を置いておくので自分のと見比べて欲しい。<br><br>

<center>
<video width="500" controls>
  <source src="bccFe_shear.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
</center>
<br>
		
さて、いつものようにスクリプトを見ていこう。まずは最初のブロックを表示する。
		<pre>
<font color="green"; size="+1">
# variable x_lattice equal 25
# variable y_lattice equal 25
# variable z_lattice equal 25
# variable max_step equal 5000
</font></pre>
		
最初の4行はコメント文でLAMMPSの実行には何も影響を与えない。ここでコメントアウトされたvariableコマンドの変数は上記のコマンドラインにおける"-v"フラグで定義され、値が与えられる。そのことを忘れないようにここに記述した。すなわち上の実行コマンドのように"-v"フラグ使うということは、上記４つのコメント文をアンコメントしてこれら4変数を定義したことと等価になる。<br><br>
次のブロックを表示する。
<pre>		
<font size="+1"; color="green">
units metal
boundary p p p
atom_style atomic
lattice bcc 2.83 orient x 1 0 0 orient y 0 1 0 orient z 0 0 1
region sim_box block 0 ${x_lattice} 0 ${y_lattice} 0 ${z_lattice} units lattice
create_box 1 sim_box
create_atoms 1 box
</font>
</pre>

この部分はすでに<a href="relax.html">構造緩和を行う</a>で説明したスクリプトの最初の部分とほぼ同じなので、改めて説明の必要はないはずだ。違うところはregionコマンドにおいて変数が使われていることだけである。LAMMPSのスクリプトでは、"${a}"という記述は変数aを参照する時に使われる。よって、このregionコマンドは、"x_lattice"などの変数が代入されて実行されたことになる。（厳密には"x_lattice"で定義された文字列が代入されただけだが、結果的に数値が代入されたことと等価なので、今そのことを気にする必要はない。）このように"-v"フラグを使えば、LAMMPSを実行させるごとにボックスの大きさを変えたりでき、1つのスクリプトを柔軟に運用できる。<br><br>

次に行こう。

<pre>		
<font size="+1"; color="green">
variable boundary_width equal 3
variable vacuum_high equal ${z_lattice}-${boundary_width}
region lower_vacuum block INF INF INF INF INF ${boundary_width} units lattice
region upper_vacuum block INF INF INF INF ${vacuum_high} INF units lattice
delete_atoms region lower_vacuum
delete_atoms region upper_vacuum
</font>
</pre>

さてここはちょっと複雑なのでじっくり読んで欲しい。1つ前のブロックにおけるboundaryコマンドでは、3方向で周期的境界条件が指定されている。これは上の図の上下の面が連続していることを意味している。よってこのままで上の図のようなせん断変形を行うと上の面の動きに下の面が引きずられてしまう。これを避けるためには、上下の面を乖離させる必要がある。そのため、上下それぞれの面を少しずつ削ることにする。それを行なっているのがこのブロックである。<br><br>

最初のvariableコマンドではその削り幅boundary_widthを"3"と定義した。後のコマンドでわかるが数値の単位は格子定数である。よって材料サンプルの上下の面は格子定数の6倍の距離だけ離されることになりお互いの影響はなくなる。次のvariableコマンドでは削られたあとの新たな上面の位置が定義されている。<br><br>

次の2つのregionコマンドは、削られる上下の領域、lower_vacuumとupper_vacuumを定義している。すでに学んだが"block"は領域の種類を表すキーワードでここでは直方体の空間で、続く6つの値によって具体的な領域が定義される。"INF"もすでに出てきたが限界の値をとることを意味している。それに続く、"units lattice"ではregionコマンドで使われる数値の単位を格子定数に指定している。これは上で意図した通りである。<br><br>
		
最後の2つのdelete_atoms regionコマンドは指定された領域の中の全原子を削除するコマンドで、これで上下の面を少しずつ削ることができる。<br><br>

次に行く。

<pre>		
<font size="+1"; color="green">		
variable	lower_board equal ${boundary_width}+${boundary_width}
variable	upper_board equal ${vacuum_high}-${boundary_width}
region		lower block INF INF INF INF INF ${lower_board} units lattice
region		upper block INF INF INF INF ${lower_board} INF units lattice
group		lower region lower
group		upper region upper
group		boundary union lower upper
group		mobile subtract all boundary
</font>
</pre>

このコマンドブロックでは上の図のグレーの部分、すなわち固定する底板と移動させる天板を定義する。<br><br>

最初の2つのvariableコマンドは底板の一番上の位置と天板の一番下の位置を定義している。<br><br>

次に底板と天板の領域をregionコマンドで定義する。この領域には上で作った真空の部分も含まれるが、もうそこには原子はないのでこの後の処理において気にする必要なない。<br><br>

次の2つのgroup ... regionコマンドは"region"の後に記述された領域（ここでは"lower"と"upper"）内にある全ての原子をグループ化するコマンドである。<br><br>

次のgroup ... unionコマンドは"union"の後に記述された複数のクループを足し合わせて新たなグループを作るコマンドである。ここで底板と天板のグループを足し合わせて新たに"boundary"というグループを作った。<br><br>

次のgroup ... subtractコマンドはunionの逆でグループの引き算である。ここでは全体ボックス内の全ての原子（all）からboundaryグループに属する原子を削除し、残った原子グループを新たに"mobile"と定義した。<br><br>

なお、regionとgroupは混同しやすいが、<b>regionは空間、groupは原子の集まり</b>と覚えておこう。<br><br>		

次に行く。
<pre>		
<font size="+1"; color="green">		
pair_style eam/fs
pair_coeff * * ./potentials/Fe_mm.eam.fs Fe
neigh_modify every 1 delay 0 check yes
</font>
</pre>

最初の2行は鉄の原子間ポテンシャルの定義であり、<a href="relax.html">構造緩和を行う</a>のところで説明したので繰り返さない。<br><br>
		
次は、nigh_modifyコマンドであるが、実はこのコマンドの前に隠れたコマンドがあり、それを最初に説明する。それはNeighborリストの定義である。LAMMPSにおいて原子間ポテンシャルはデータファイルとして定義されている。そこにはある距離より遠い原子ペアでは原子間力を無視するとするcutoff距離が定義されている。これにより不要な計算を避けることができ、効率化できる。逆に言えば、cutoff距離より近い原子ペアは原子間ポテンシャルが計算される。Neighborリストとはその計算を行うペアのリストである。しかし現実的には、原子が移動するので、少し余裕を持たせてcutoff距離より少し離れている原子ペアも原子間ポテンシャルを計算させなければならない。この余裕のことをskinと呼ぶ。スクリプトの最初に"units metal"が選ばれた場合のディフォルトは"neighbor 2.0 bin"となっている。すなわち、厚さ2.0 Angstromのskinを用いる。ここで記述された"bin"はネイバーリストを作るアルゴリズの種類であり詳しいことは説明しない。よって実際にはこのコマンドがすでに実行されている。ちなみに、skinが増えれば使用するメモリが増えるので計算中メモリがいっぱいになってしまう場合は、許される範囲でskinを薄くすることを考えてもいい。<br><br>

本題の"neighbor_modify"コマンドの説明にもどろう。ここでは、"every <n> delay <m>"は新しいNeighborリストがビルドされてからmステップ数の後、nステップ数の度にリストが更新されることを意味している。ただし、"check yes"はある条件を満したときのみリストを更新することを指定している。この条件とは原子の移動距離がskinに達した場合である。ディフォルトは"every 1 delay 0 check yes"である。よって元々このラインは不要なのだが、これらのパラメータを変えることによって計算時間を短縮できる可能性がある。例えば、原子が激しく動いていない場合にはリスト更新を間引きしてもよいし、逆に原子が激しく動く場合はいちいちチェックする計算時間がもったいないのでcheck noがいいかもしれない。<br><br>		

次に行く。
		
<pre>		
<font size="+1"; color="green">		
fix 1 all box/relax iso 0.0 vmax 0.001
thermo		200
thermo_style custom step pe lx ly lz press
min_style cg
minimize 1.e-25 1.0e-12 10000 50000
unfix 1
</font>
</pre>

次のfix ... box/relaxコマンドは体積緩和を行うためのコマンドで、すでに習った。<br><br>

次のthermoコマンドは系の変数を計算するインターバルを指定するコマンドであり、200計算ステップごとに変数が計算されその結果が標準出力に出力されることになる。<br><br>

次のthermo_style customコマンドはその標準出力への出力フォーマットを定義する。この例では"step"（シミュレーションステップ）、"pe"（全ポテンシャルエネルギー）、"lx ly lz"（ボックスの3方向のサイズ）、"press"（圧力）が表示されるようになる。<br><br>

次の"min_style"コマンドとminimizeコマンドは<a href="relax.html">構造緩和を行う</a>のところで出てきたので説明を繰り返さない。<br><br>

次のunfixもすでに学んだ。これはfixコマンドが使われてその役目を終えた時、それを無効化する手続きである。ここでは構造緩和の計算が終了したのでこのブロック先頭の"fix ... box/rescale"コマンドを無効化している。<br><br>

次のブロックに行く。
		
<pre>		
<font size="+1"; color="green">		
variable set_temp equal 10.
velocity 	mobile create ${set_temp} 1582775
fix		1 all nve
fix		2 boundary setforce 0.0 0.0 0.0
fix		3 mobile temp/rescale 10 ${set_temp} ${set_temp} 0.1 1.0
reset_timestep 	0
run 		1000
</font>
</pre>

このスクリプト部分では底板と天板に挟まれた"mobile"グループに属する原子群を設定温度でアニールする。<br><br>

次のvariableコマンドでは"set_temp"という変数を定義し10を代入している。<br><br>

次のvelocity createコマンドは<a href="anneal.html">アニーリングを行う</a>ですでに述べたが温度を設定するためのコマンドである。ここではmobileグループの原子群にset_tempで定義された温度（K）を入れている。mobileグループは底板と天板に挟まれた場所にある原子群である。<br><br>

次の"fix ... nve"コマンドは系全体（すなわちall）を原子数一定、体積一定、エネルギー一定で（すなわちミクノカノニカルアンサンブルで）時間積分を行うことを指定している。もうお分かりと思うが、ここでは計算法を指定しただけで、実際の計算はまだ始まらない。<br><br>

次のfix ... setforceコマンドは原子間力を強制的に与えるためのコマンドで底板と天板を合わせた"boundary"グループでは原子間力は0になる。すでに述べたが、これらの部分の原子の運動は原子間ポテンシャルによって決まるのではなく強制的に固定したり動かしたりする部分なのでこのように設定しておく。材料変形のMDでは、このように強制的に原子群を固定したり動かしたりする場面が出てくるが、その時このfix ... setforceコマンドが役に立つだろう。ここでfixの識別子が"2"になっていることに注目しよう。fixコマンドは複数実行することができ、識別子によって区別される。無論、同じ識別子を持つ2つ以上のfixコマンドを実行することはできない。<br><br>

次のfix ... temp/rescaleコマンドは<a href="anneal.html">アニーリングを行う</a>で既出であるので詳しい説明はしないが、温度調整が"mobile"グループだけになっている。これは原子間ポテンシャルによって有限温度で時間発展するのが"mobile"グループだけだからである。<br><br>

次のreset_timestepもすでに説明したがシミュレーションの時間ステップを初期化している。実は何もしなくても最初は0.初期化されるので、このコマンドは必要ないのだが、スクリプトの意図を明確にするために書いておいても良い。<br><br>

さてここまで準備ができて、やっとアニールをrunコマンドで実行する。ここでは計算の負荷を減らすために1000ステップ（1 ps）の長さにしてあるが、本来ならこの100倍の100 psぐらいにした方が良いだろう。これでmobileグループの中の原子がアニーリングされることになる。ただ、"fix ... setforce"コマンドによって上下のグループは動かないので、boundaryグループ原子がmobileグループの中に入り込んだり、その逆の現象も起きない。<br><br>

次に行こう。

<pre>		
<font size="+1"; color="green">		
velocity	upper set 0.1 0. 0.
reset_timestep 	0
dump 		1 all custom 200 bccFe_shear_*.out id type xs ys zs
run		${max_step}
</font>
</pre>

これがスクリプトの最後の部分である。まずvelocity setコマンドだが、前出のvelocity createととは異なって指定されたグループに一様な速度を与えるコマンドである。最初の引数の"upper"は速度を与えるグループで、図中の天板に属する原子群である。setに続く3つの数字はそれぞれ(x,y,z)方向の速度である。速度の単位だが、スクリプトの最初でunits metalが宣言された場合Angstrom/psになる。<br><br>
		
次のreset_timestepコマンドはすでに説明した。この場合は時刻はすでに1000ステップ（1 ps）まで進んでいるので省略することはできない。<br><br>

次のdumpコマンドもこれまでの説明からほぼ理解できるだろう。これまでと違う点はファイル名に"_*"という部分を加えたことである。これまではdumpで出力されたファイルは1つのファイルであったが、この方法だと1つのファイルのサイズが大きくなりすぎる場合がある。今回のようにすると、上で見たようにbccFe_shear_0.outから200ステップ刻みで複数のファイルができることになり、1個のファイルが大きくなるのを防ぐことができる。<br><br>
		
そして最後のrunコマンドで上の標準入力へのコマンドラインで指定された時間長さだけシミュレーションが行われる。これでスクリプトの説明は終わりだ。このスクリプトに限らないが、おおよその内容がわかったらパラメータを変化させて様々なケースを行なうと理解が進むだろう。<br><br>

構造緩和とアニーリングを行った後、興味ある現象のMDを行うという流れはよく使うので、今回のスクリプトは様々なスクリプトの雛形となるだろう。
		
<pre>
-----------------------------------------------------------
</pre>
<a href="index.html">目次へ</a>     前は<a href="anneal.html">アニーリングを行う</a>     次は<a href="tensile.html">引っ張り変形を行う</a>
<br><br>
</body>
</html>
