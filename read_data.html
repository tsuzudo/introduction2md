<!doctype html public "-//w3c//dtd html 4.0 transitional//en">

<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<head>
<title>LAMMPSの外部で初期値を作る</title>
</head>

<body bgcolor="ffffcc">
<center><h2 style="color:Blue;">LAMMPSの外部で初期値を作る</h2></center><br>

これまでの講座でいくつかのMDの例を学んできた。それらの例では、動的な計算を始める前にまず初期値を作ったことを思いだして欲しい。そのような初期状態はLAMMPSのスクリプト実行中にcreate_atomsコマンドなどを用いて作られた。しかし別の方法もある。それを紹介するのが今回の講座である。<br><br>

LAMMPSのスクリプトは一般のプログラミング言語に比べて必ずしも使いやすいとは言えない。よって自分が望むような初期値が容易に作れない場合があるかもしれない。こういった問題が生じた場合は、<b>自分の好きなプログラミング言語であらかじめ初期値を作っておき、それをスクリプト内で読み込ませる</b>ことによって解決できる。<br><br>

また、同じ初期値を何度も使って別の条件でMDを繰り返し行う場合は、LAMMPSに同じ初期値を何度も作らせるのは非効率的である。よってあらかじめ作っておいた初期値を読み込ませれば計算リソースの節約になる。<br><br>
        
さて、以下では実際の例に従ってその方法を学ぶことにする。<br><br>

まず、LAMMPSに原子の状態をファイルから読み込ませるには、そのファイルは適切なフォーマットを有してなければならない。例として、"file.in"という名前で下のようなフォーマットで書かれたテキストファイルをscriptフォルダーに作っておいた。
        
<pre>
<font color="green"; size="+1">	
# bcc Fe lattice points  

31250 atoms
1 atom types

0.000000 71.382500 xlo xhi
0.000000 71.382500 ylo yhi
0.000000 71.382500 zlo zhi

Atoms

    1     1       0.000000000000       0.000000000000       0.000000000000
    2     1       1.427650000000       1.427650000000       1.427650000000
    3     1       0.000000000000       0.000000000000       2.855300000000
    4     1       1.427650000000       1.427650000000       4.282950000000
    5     1       0.000000000000       0.000000000000       5.710600000000
    ...........
</font>
</pre>

これまでスクリプトを説明してきたように、上の内容をステップバイステップで見て行こう。まず#で始まる行や空の行はLAMMPSのスクリプトと同様に無視される。よって実質的には3行目から意味のある内容が始まっている。<br><br>

まず最初に、原子の総数を示している。ここでは31250個の原子で構成される初期値を作ることになる。<br><br>

次が、原子種の数、ここでは1種類とする。ただし、この数はスクリプト内の記述、例えば用いる原子間ポテンシャルと矛盾しないようにしなくてはならない。<br><br>

次の3行はボックスの定義だ。71.3825 Angstromの立方体の中でシミュレーションが実行されることになる。<br><br>

次の"Atoms"は以下の行から原子のデータが始まることを示している。<br><br>

各原子データは原子の通し番号（この場合は1から総原子数31250までの数）、原子種、原子のx、y、z座標で構成されている。原子の通し番号は同じものや抜けがあってはならない。原子種はこの場合は全て1、すべての原子座標は0と71.3825の間の値でなくてはならない。<br><br>

非常に単純な構造をしているので受講者が知っている言語（例えばC言語やPythonなど）で初期値を作るためのプログラムを容易に作ることができるはずだ。複雑な初期状態を作成するにはスクリプトの高度なスキルが必要な場合が多く、LAMMPS初心者にとっては少し敷居が高いが、外部で初期状態を作る方法はそれを回避できる。<br><br>

さて、今度は上で作ったファイルを実際に読み込む作業をしてみよう。上記のfile.inを読み込んで構造緩和させるだけのスクリプトがscriptフォルダーの中の"bccFe_read_data.lcm"である。その中身を以下で一気に表示する。

<pre>
<font color="green"; size="+1">	
units		metal
boundary p p p
atom_style	atomic
read_data file.in

pair_style eam/fs
pair_coeff * * ./potentials/Fe_mm.eam.fs Fe

dump 1 all custom 100 bccFe_read_data.out id type xs ys zs
neigh_modify every 1 check yes
fix 1 all box/relax iso 0.0 vmax 0.001

min_style cg
minimize 1.0e-12 1.0e-12 1000 10000
</font>
</pre>

1行目から3行目まではこれまでの講座で何度も出てきたので説明は不要だろう。<br><br>

4行目で、上のように<b>作成した初期値データfile.inをread_dataコマンドで読み込む。</b>使い方は至ってシンプルである。<br><br>

その後は<a href="relax.html">構造緩和を行う</a>の講座で説明したように、構造緩和を行っている。改めて説明は不要だろう。<br><br>

この方法を使った場合、これまで初期値を作るのに使ってきたlatticeコマンド、create_boxコマンドおよびcreate_atomsコマンドは不要となる。<br><br>

そして、以下の要領で実行する。

<pre>
<font color="green"; size="+1">	
$work> lmp_serial -in script/read_data.lcm
</font>
</pre>

計算が終了したら、標準出力で構造緩和がうまくいったことを確認し、workディレクトリの中にできたbccFe_read_data.outをOVITOで読み込み、画像を確認しよう。<br><br>

ここで紹介した方法は短い行数で実現できるためスクリプトで初期値を作るよりも優れているような気がする。しかし、必ずしもそうではなくディメリットもある。それは、どういう計算をさせたかという記録を保存する時に、スクリプトだけでなく初期値も一緒に保存させておく必要があることだ。非常に多くのケースを扱う場合には2つのファイルをペアでとっておくというのはひと手間多く、ちょっとした混乱に原因になりうる。つまり、1つのスクリプトファイルの中にMDの全ての情報を含ませておいた方が計算結果を整理しやすい。というわけで、メリットとデメリットを理解した上でこの方法を採用するのが良い。<br><br>
        
また、MDを利用する場面でよく遭遇するのが、すでに行ったMDの途中結果や最終結果を初期値としたい場合である。これらの結果は上で出てきたようにdumpコマンドによって出力されるが、その出力ファイルをそのまま初期値として読み込んでもフォーマットが異なるのでうまくいかない。この場合はフォーマットを変換するプログラムが必要になる。これまでdumpコマンドの利用例を学んできたが、いずれも特定のcustom形式の出力ファイルだった。これはOVITOで結果を解析するために選択したフォーマットである。それを初期値のフォーマットに変換するにはプログラムを自作すると良い。ファイルを読み込んで別のフォーマットで保存するだけなので、どんなプログラム言語でも簡単なプログラミングで済む。
        


<pre>
----------------------------------------------------
</pre>
<a href="index.html">目次へ</a>     前は<a href="cascade.html">照射損傷をモデル化する</a>     次は<a href="edge.html">刃状転位を挿入する</a>
<br><br>
</body>
</html>
